# If you come from bash you might have to change your $PATH.
# export PATH=$HOME/bin:/usr/local/bin:$PATH
export TERM="xterm-256color"
export CURRENTPROJECT="$HOME/workspace/tal/tal/services/mrd_integration/"
export OS='/Users/craig.ferguson'
export STERN='stern --context kubernetes-admin@kubernetes'
export KUBE_UAT_NAMESPACE="wmstesting"
export KUBE_CRAIG_NAMESPACE="craig"
export OFFICE="kubectl --context kubernetes-admin@kubernetes"
export UAT="$OFFICE --namespace wmsuat"
export CK="$OFFICE --namespace $KUBE_CRAIG_NAMESPACE"
export WMSTESTING="$OFFICE --namespace $KUBE_UAT_NAMESPACE"
export MASTER="$OFFICE --namespace master"
export PIP_REQUIRE_VIRTUALENV=true
export TA=$HOME/workspace/dev-environments/kubernetes-environments/environment/roles/
export TP=$HOME/workspace/dev-environments/kubernetes-environments/environment/patches/development/
export CP=$HOME/workspace/cdev/kube/deployments
export PATH=$PATH:/opt/hub-linux-amd64-2.3.0-pre9/bin/
export PATH=$PATH:/opt/bin/
export PATCH=/home/craig/workspace/cdev/kube/patch.sh
#export GREP_OPTIONS='--color=auto'

alias branchinfo="cat $HOME/workspace/cdev/branches_reference"
alias branchinfoedit="vim $HOME/workspace/cdev/branches_reference"

alias v=vim .
#alias keys="vim $HOME/.vimkeys.vimrc"
alias keys="vim $HOME/keys.vimrc"
alias shortcuts="vim $HOME/.khdrc"
alias plug="vim $HOME/plug.vimrc"
alias dc=docker-compose
alias n="nautilus"
alias mbs="cd $HOME/git_repos/mybondsite/backend;"
#
#alias officek='kubectl --context kubernetes-admin@kubernetes'
alias helpibt='open -a "Google Chrome" https://jira.takealot.com/wiki/display/TET/Auto+IBT+Process'
alias prodk='kubectl --context production'
pkd(){
  kubectl --context production delete pod $1
}
alias ck="$CK"
alias wmstesting="$WMSTESTING"
alias ke="kubectl exec -i -t"
alias ka="kubectl attach -i -t"
alias office="$OFFICE"
alias wmsuat="$UAT"
alias master="$MASTER"
alias ptw="ptw -- -x --lf"
alias tal="cd $HOME/workspace/tal"
alias dimms="cd $HOME/workspace/s4f-dimension-processor"
alias sick="cd $HOME/workspace/s4f-sick-integration-service"

# DIMs
pushdims() {
  md
  here=$(pwd)
  cd $HOME/workspace/s4f-dimension-processor && docker build -t image-registry.ci.env:80/takealot/s4f-dimension-processor:WMS-1910 . && docker push image-registry.ci.env:80/takealot/s4f-dimension-processor:WMS-1910
  cd $here
  sftp=$(kubectl --context kubernetes-admin@kubernetes --namespace wmsuat get pod -o name | grep sftp-consumer | sed 's/pods\///')
  wmsapi=$(kubectl --context kubernetes-admin@kubernetes --namespace wmsuat get pod -o name | grep wmsapi-consumer | sed 's/pods\///')
  kubectl --context kubernetes-admin@kubernetes --namespace wmsuat delete pod  $sftp
  kubectl --context kubernetes-admin@kubernetes --namespace wmsuat delete pod  $wmsapi
}
add_sftp_file_uat() {
  here=$(pwd)
  cd $HOME/workspace/cdev/helpers/sftp
  python uat_sftp_client.py
  cd $here

}

hiuat() {
  helm upgrade --install $1 --kube-context kubernetes-admin@kubernetes  $2 --namespace wmsuat
}
hduat() {
  helm del --purge --kube-context kubernetes-admin@kubernetes $1
}
huatls() {
  helm --kube-context kubernetes-admin@kubernetes --namespace wmsuat ls
}

alias hwms="helm upgrade --install wms-service ~/workspace/tal/charts/wms-service/ --set image.pullPolicy=IfNotPresent,dev.patch=true,dev.mountPath=/usr/local/tal/tal,dev.hostPath=$HOME/workspace/tal,resources.requests.cpu=400m,resources.limits.cpu=430 "
alias hdims="helm upgrade --install dims $OS/workspace/s4f-dimension-processor/charts/s4f-dimensions-processor --set image.pullPolicy=IfNotPresent,dev.patch=true,dev.hostPath=$OS/workspace/s4f-dimension-processor,dev.mountPath=/usr/local/tal/s4f-dimension-processor,image.tag=WMS-1910,resources.requests.cpu=300m,resources.limits.cpu=330"
alias hswms="helm upgrade --install service-wmsm ~/workspace/service_wms/charts/s3f-wms-service/ --set image.pullPolicy=IfNotPresent,dev.patch=true,dev.hostPath=$OS/workspace/service_wms,resources.requests.cpu=400m,resources.limits.cpu=430 "
alias hsick="helm upgrade --install sick-service $HOME/workspace/s4f-sick-integration-service/charts/s4f-sick-integration-service --set image.pullPolicy=IfNotPresent,dev.patch=true,dev.mountPath=/usr/local/tal/s4f-sick-integration-service,dev.hostPath=$HOME/workspace/s4f-sick-integration-service,resources.requests.cpu=300m,resources.limits.cpu=330"
alias htimer="helm upgrade --install s4f-timer-service ~/workspace/s4f-timer-service/charts/s4f-timer-service --set image.pullPolicy=IfNotPresent,dev.patch=true,dev.mountPath=/usr/local/tal/s4f-timer-service,dev.hostPath=`pwd`/workspace/s4f-timer-service,resources.requests.cpu=300m,resources.limits.cpu=330 "
alias horders="helm upgrade --install order-service ~/workspace/tal/charts/order-service --set image.pullPolicy=IfNotPresent,dev.patch=true,dev.mountPath=/usr/local/tal/tal,dev.hostPath=`pwd`/workspace/tal,resources.requests.cpu=300m,resources.limits.cpu=330 "
alias hcomms="helm upgrade --install comms ~/workspace/s4f-comms-service/charts/s4f-comms-service --set image.pullPolicy=IfNotPresent,dev.patch=true,dev.mountPath=/usr/local/tal/s4f-comms-service/comms_service,dev.hostPath=`pwd`/workspace/s4f-comms-service/comms_service,resources.requests.cpu=300m,resources.limits.cpu=330 "
alias hdel='helm del --purge'
#watch network
alias watchnet="watch -n 1 'sudo netstat -tanop'"
alias watchsockets="watch -n 1 'ss -s'"

alias suat="stern --context kubernetes-admin@kubernetes -n wmsuat"
alias smaster="stern --context kubernetes-admin@kubernetes -n master"
#watching kubes
#alias watch1="$HOME/workspace/cdev/kube/watch_kube.py kubectl"
#alias watch1="watch -n 1 'kubectl get pods --all-namespaces'"
#alias watchuat="$HOME/workspace/cdev/kube/watch_uat.py"
#alias watch2="$HOME/workspace/cdev/kube/watch_kube.py '$CK'"

alias pods_wmstesting="watch -n 1 'kubectl --context kubernetes-admin@kubernetes --namespace wmstesting get pods'"
os=$(uname -s)
if [[ $os = Linux ]];
then
  echo config for $os
  alias protoc26='/usr/local/bin/protoc'
else
  echo config for $os
  alias protoc26='/usr/local/opt/protobuf@2.6/bin/protoc'
fi
generateprotota(){
  #protoc26 -I=$SRC_DIR_of_.proto_files --python_out=$DST_DIR_for.py_serializers $SRC_DIR/path_to_file.proto
  cd $HOME/workspace/s4f-protocol-buffers
  protoc26 -I . --python_out=../s4f-python-clients/s4f_clients/compiled_protobuffs ./*.proto
  protoc26 -I . --python_out=../s4f-comms-service/comms_service/compiled_protobuffs ./*.proto
  protoc26 -I . --python_out=../s4f-shipping-options-service/shipping_options_service/compiled_protobuffs ./*.proto
}
alias generate_comms_service_protobuffs=""


restart_kube() {
  minikube stop
  minikube start
  echo 'md'
}
watch_wmstesting() {
  #sftp=$(kubectl --context kubernetes-admin@kubernetes --namespace wmstesting get pod -o name | grep sftp-wms | sed 's/pods\///')

  # give sftp in wmstesting so can copy files
  #$HOME/workspace/cdev/kube/watch_pods.py $WMSTESTING $sftp

  # watch logs for testing namespace tsin specific
  $HOME/workspace/cdev/kube/sterntsinconsumers.py wmstesting
}
wmsuate() {
  kubectl --context kubernetes-admin@kubernetes --namespace wmsuat exec -it $1 bash
}
watchuat() {
  ttab -t "UAT"  "watch -n 1 'kubectl --context kubernetes-admin@kubernetes get pods --namespace wmsuat'"
  ttab -t "UAT"  "watch -n 1 'kubectl --context kubernetes-admin@kubernetes get services --namespace wmsuat'"
}
watch1() {
  ttab -t "MINIKUBE"  "watch -n 1 'kubectl get pods --all-namespaces'"
  ttab -t "MINIKUBE"  "watch -n 1 'kubectl get services --all-namespaces'"
}
watch_mini() {
  $HOME/workspace/cdev/kube/stern_local.py
  $HOME/workspace/cdev/kube/watch_pods.py kubectl
  exit
}
lf () {
  ls | grep $1
}

watch3() {
  #lsftp=$(kubectl get pod -o name | grep tsin-dimensions-sftp | sed 's/pods\///')
  sftp=$(kubectl --context kubernetes-admin@kubernetes --namespace wmsuat get pod -o name | grep sftp-wms | sed 's/pods\///')
  #poller=$(kubectl --context kubernetes-admin@kubernetes --namespace wmstesting get pod -o name | grep cub-poller | sed 's/pods\///')
  #if [[ -z $lsftp ]]
    #then
    #echo 'please make sure local tsin-dims sftp consumer is running'
  #fi
  #if [[ -z $sftp ]]
    #then
    #echo 'please make sure sftp is running in uat namespace : wmstesting'
  #fi
  #if [[ -z $poller ]]
    #then
    #echo 'please make sure cub poller is running in uat namespace'
  #fi
  $HOME/workspace/cdev/kube/watch_pods.py $UAT $sftp
# pass in namespace as first arg
  $HOME/workspace/cdev/kube/sterntsinconsumers.py wmsuat
}
start_code() {
  nohup hipchat4 &
  nohup chromium --new-window https://calendar.google.com/calendar/render
}
sftp_uat() {
  echo '(|EP4).C'
  sftp takealot_uat_if@uatsftp.logfireapps.com
}
sftp_box(){
 export sftp="Pt8e$d7W%7e"
 sftp takealotif@b1sftplogfireapps.com
}
#add_sftp_file(){
  #sftp=$(kubectl --context kubernetes-admin@kubernetes --namespace wmstesting get pod -o name | grep sftp-wms | sed 's/pods\///')
  #wmstesting exec -i -t $sftp -- bash -c "cp /tmp/CUB_TEST_001 /home/wms/data/TAL/CPT/output/$1"

  #sshpass -e sftp -oBatchMode=no -b - takealot_uat_if@uatsftp.logfireapps.com
#sshpass -e sftp -oBatchMode=no -b - sftp-user@remote-host << !
   #cd incoming
   #put your-log-file.log
   #bye
#!
#}

#run interactive
alias r1wms="kubectl run wms-service -i --tty --image 10.4.1.39:5000/takealot/tal-with-requirements:master --env='ROLE=KUBERNETES' -- bash -c '/usr/local/tal/tal/bin/gunicorn-docker-entry.sh \"tal.services.wms.server:application\"'"
#temp create c delete d for k8s:
#alias c1adap="kubectl create -f $TA/adaptris-service"
#alias d1adap="kubectl delete -f $TA/adaptris-service"
#alias c1wms="cat $TA/wms-service/wms-deployment.yaml | sed 's|imagePullPolicy: Always|imagePullPolicy: IfNotPresent|' | kubectl create -f -; kubectl create -f $TA/wms-service/wms-service.yaml"
#alias d1wms="kubectl delete -f $TA/wms-service"
#alias c1dims="kubectl create -f $TA/s4f-dimension-processor-service/warehouse-tsin-dimensions-sftp-consumer-deployment.yaml"
#alias d1dims="kubectl delete -f $TA/s4f-dimension-processor-service/warehouse-tsin-dimensions-sftp-consumer-deployment.yaml"
#alias c1kafka="kubectl create -f $TA/kafka/"
#alias d1kafka="kubectl delete -f $TA/kafka/"
#alias c1ingress="kubectl create -f $TA/ingress/"
#alias d1ingress="kubectl delete -f $TA/ingress/"

alias csicks="kubectl create -f $HOME/workspace/cdev/kube/deployments/sick_server"
alias dsicks="kubectl delete -f $HOME/workspace/cdev/kube/deployments/sick_server --grace-period=5"
alias csickc="kubectl create -f $HOME/workspace/cdev/kube/deployments/sick-client-deployment.yml"
alias dsickc="kubectl delete -f $HOME/workspace/cdev/kube/deployments/sick-client-deployment.yml --grace-period=5"
#alias csickc="kubectl create -f $HOME/workspace/cdev/kube/deployments/sick-client-pdb-deployment.yml"
#alias dsickc="kubectl delete -f $HOME/workspace/cdev/kube/deployments/sick-client-pdb-deployment.yml"
alias csftp="kubectl create -f $TA/sftp/"
alias dsftp="kubectl delete -f $TA/sftp/"
alias d2wms="$CK delete -f $TA/wms-service"
alias c2dims="$CK create -f $TA/s4f-dimension-processor-service/"
alias d2dims="$CK delete -f $TA/s4f-dimension-processor-service/"
alias c2sftp="$CK create -f $TA/sftp/"
alias d2sftp="$CK delete -f $TA/sftp/"

alias c3wms="$WMSTESTING create -f $TA/wms-service"
alias d3wms="$WMSTESTING delete -f $TA/wms-service"
alias c3dims="$WMSTESTING create -f $TA/s4f-dimension-processor-service/"
alias d3dims="$WMSTESTING delete -f $TA/s4f-dimension-processor-service/"
alias c3sftp="$WMSTESTING create -f $TA/sftp/"
alias d3sftp="$WMSTESTING delete -f $TA/sftp/"

#execute e temp
alias e1wms="kubectl run c-wms-shell --rm -i --tty --image 10.4.1.39:5000/takealot/tal-with-requirements -- bash"
#alias e1dims="kubectl run c-dims-shell --rm -i --tty --image 10.4.1.39:5000/takealot/s4f-dimension-processor:master -- bash"

#DEBUGGING DIMS
alias dec1dimssftp="kubectl create -f $CP/sftp-dimensions-consumer.yaml"
alias ded1dimssftp="kubectl delete -f $CP/sftp-dimensions-consumer.yaml"
alias dec1dimswmsapi="kubectl create -f $CP/wmsapi-dimensions-consumer.yaml"
alias ded1dimswmsapi="kubectl delete -f $CP/wmsapi-dimensions-consumer.yaml"
dee1dimssftp() {
  kubectl exec -i -t $1 -- bash -c "kafka_consumer --consumer_type tsin_dimensions_sftp"
}
dee1dimswmsapi() {
  kubectl exec -i -t $1 -- bash -c "kafka_consumer --consumer_type tsin_dimensions_wmsapi"
}
alias e1dims2166="kubectl run c-dims-shell --rm -i --tty --image 10.4.1.39:5000/takealot/warehouse_pack:master -- bash"

#
#patch
alias p1adap="$PATCH $TP/adaptris-deployment.yaml"
p1dims() {
  $PATCH $TP/s4f-dimension-processor/warehouse-tsin-dimensions-sftp-consumer-deployment.yaml
  $PATCH $TP/s4f-dimension-processor/warehouse-tsin-dimensions-wmsapi-consumerdeployment.yaml
}
#
#view v
alias vwms="cd $HOME/workspace/tal/tal/services/wms/"
alias vdims="cd $HOME/workspace/s4f-dimension-processor/;vim ."
alias vadap="cd $HOME/workspace/tal/tal/services/adaptris/;vim ."
alias vmrd="cd $HOME/workspace/tal/tal/services/mrd_integration/;vim ."
alias vkaf="cd $HOME/workspace/tal-kafka/;vim ."
alias run="python manage.py runserver"
#alias size="/home/craig/.screenlayout/laptop.sh"
alias rec="/home/craig/git_repos/receipts/receipts_server"
alias kaf="cd $HOME/git_repos/kafka/code;"
alias fa='cd $HOME/git_repos/future-apps'

alias k="kubectl"
alias ksetup="source <(kubectl completion zsh)"
alias ksetup="source <(helm completion zsh)"
alias kc="kubectl create"
alias kgp="kubectl get pods -owide --all-namespaces --show-all"
alias pgp="kubectl --context production get pods -owide --all-namespaces --show-all"
alias kdd="kubectl delete deployment"
alias minikubedockerexit='eval $(minikube docker-env -u)'
alias reload='exec $SHELL -l'
alias pj='cd ~/git_repos/psychicjenha/frontend'
alias tk='cd ~/workspace/tal-kubernetes'
alias set="source <(kubectl completion zsh)"
alias pa="pyenv activate testing; ipython"
alias config="vim ~/.zpreztorc;"
alias ipy=ipython
alias edit='vim ~/.zpreztorc'
eval $(thefuck --alias f)
fpath=(~/.zsh/completion $fpath)
autoload -Uz compinit && compinit -i

alias gitalias='vim $HOME/.zprezto/modules/git/alias.zsh'
alias gst="git status"
alias gp="git pull"
alias kafcreate='hello'
#patches to k8s
alias p1wms='$HOME/workspace/cdev/kube/patch.sh $TP/wms-deployment.yaml'

#temps
alias ipyvim='pyenv activate neovim3; ipython kernel; watch'
alias es='cd ~/workspace/tal_big_data/reports/2017-06_grad_big_data/'
alias sickd='cd ~/workspace/dev-environments/kubernetes-environments/environment/roles/s4f-sick-integration-service/'
alias adapt='cd ~/workspace/tal/tal/services/adaptris/test/;'
alias sis='cd ~/workspace/s4f-sick-integration-service/'
alias gogo='cd $HOME/git_repos/kafka/code && ./tal-commands.py'
alias prod="$CURRENTPROJECT;vim ."
#end temps
#
#
eval "$(pyenv init -)"
eval "$(pyenv virtualenv-init -)"
setopt correct
unsetopt correctall

pep() {
    kubectl --context production exec -i -t $1 bash
}

zstyle ':prezto:load' pmodule \
         'environment' \
         'terminal' \
         'tmux' \
         'editor' \
         'history' \
         'directory' \
         'spectrum' \
         'utility' \
         'completion' \
         'git' \
         'syntax-highlighting' \
         'history-substring-search' \
         'prompt'
zstyle ':prezto:module:prompt' theme 'smiley'
savehelp() {
  echo "$@[2,-1]" >> $HOME/git_repos/craig_help/$1
}
pushtalbranchImage() {
  # get the git branch name
  cd $HOME/workspace/tal/
  export BRANCH=`git rev-parse --abbrev-ref HEAD`
  echo 'working on branch '$BRANCH
  # build the container
  export IMAGE_PATH="10.4.1.39:5000/takealot/tal-with-requirements:${BRANCH}"
  docker build -t ${IMAGE_PATH} -f Dockerfile .
  docker push ${IMAGE_PATH}
}
krun() {
  k run my-shell --rm -i --tty --image 10.4.1.39:5000/takealot/warehouse_pack:master -- bash -c " pip install pudb;export ROLE=KUBERNETES;export ENVIRONMENT=STAGING; kafka_consumer --consumer_type tsin_dimensions_sftp
"
}
krun2() {
  k exec -i --tty $1 -- bash -c "kafka_consumer --consumer_type tsin_dimensions_sftp
"
}
gac() {
  git add .
  git commit -m "{$@}"
}
ghist() {
	git log --oneline --graph --decorate --all
}
gc() {
  if [[ $1 -eq master ]]
    then
      git checkout master
    else
      git checkout WMS-"$@"
  fi

}
envv() {
  if [[ $# -eq 0 ]]
    then
      env
    else
      env | grep -i $1
  fi
}
kin () {
  kubectl run -i --tty temp --image=$1 --restart=Never -- sh
}
restartn() {
  sudo service networking restart;
  sudo service network-manager restart;
}
pullta() {
  a=$(git status | grep -c "modified")
  if [[ $a > 0 ]]
  then
    echo ''
    echo 'you have changes';
    echo ''
  else
    git pull
  fi
}

kill_local() {
  NAME=$(kubectl get pod -o name | grep wmsapi-consumer | sed 's/pods\///')
  wmsapi=$(kubectl get pod -o name | grep wmsapi-consumer | sed 's/pods\///')
  kubectl delete pod  $NAME
  kubectl delete pod  $wmsapi
}
TESTD() {
  NAME=$(kubectl get pod -o name | grep dimensions | sed 's/pods\///')
  kubectl exec  $NAME -- bash -c "pip install pytest pudb unittest2 mock"
  kubectl exec -i -t $NAME -- bash -c "cd dimension_processor/tests;pytest -s -x --lf test_dimension_processor.py"
}
TESTMR() {
  #run deployment in minikube
  NAME=$(kubectl get pod -o name | grep mrd | sed 's/pods\///')
  kubectl exec  $NAME -- bash -c "pip install pytest pudb unittest2 mock"
  #run tests
  kubectl exec  $NAME -- bash -c "pytest services/tests/test_split_shipments.py"

  #expose pod
  #
  #curl endpoint with some data
}
TESTA() {
  $PATCH $TP/adaptris-deployment.yaml
  kubectl exec  $1 -- bash -c "pip install pytest pudb unittest2"
  kubectl exec -i -t $1 -- bash -c "cd tal/services/adaptris/test;pytest -s -x --lf test_adaptris_integration.py"
}
PROD() {
  cd $HOME/workspace/s4f-dimension-processor/dimension_processor
  gnome-terminal -e "bash -c './home/craig/workspace/cdev/patch.sh /home/craig/workspace/dev-environments/kubernetes-environments/environment/patches/development/s4f-dimension-processor/warehouse-tsin-dimensions-sftp-consumer-767482075-3qrz4'"
  kubectl exec  $1 -- bash -c "pip install pytest pudb unittest2"
  kubectl exec -i -t $1 -- bash -c "cd dimension_processor;pytest -x --lf -s tests/test_dimension_processor.py"
}
checkta() {
  for foldr in ~/workspace/*/;
    do
      cd foldr;
      echo "$foldr"
      git fetch;
      pullta
    done;
}

md() {
  eval $(minikube docker-env)
  minikube ssh "echo 'Domains=stagealot.com' | sudo tee -a /etc/systemd/resolved.conf"
  minikube ssh "sudo systemctl restart systemd-resolved.service"
}
findinfiles() {
  find . -iname $1 | ack --files-from=- $2
}
dcc() {
  dc ps | grep Exit
}
dcu() {
  dc up -d --force-recreate $1
}
odev() {
cd workspace/dev-environments/docker-environment/collections && source compose.env
cd ~/workspace/dev-environments/docker-environment/collections/shared/wms-staging/
}
dev() {
cd ~/workspace/cdev/$1
}

devup() {
cd ~/workspace/dev-environments/docker-environment/collections && source compose.env
cd ~/workspace/cdev/$1
dc up --force-recreate;
}
h() {
  cd ~/git_repos/craig_help
  ls;
}
devad() {
cd ~/workspace/dev-environments/docker-environment/collections && source compose.env
cd ~/workspace/cdev/adaptris
dc exec adaptris pip install pytest pytest-watch;
dc exec adaptris bash -c 'cd tal/services/adaptris/test; ptw -- -x --lf;';
}
update-delete-repo() {
  cd $1 && git remote -vv && cd .. && sudo rm -rf $1
}
code-on() {
  git checkout -b $1 origin/master
}
jumpbox() {
  ssh-add
  ssh -A craigferguson@jump-box.takealot.com
}
grep_restapi01() {
  ttab  -t "Rest API 01" "ssh -t -A craigferguson@jump-box.takealot.com \"ssh tal-rest-api01 'cat /var/log/supervisor/services.order.error.log*'\" | grep '$1'"
}
grep_restapi02() {
  ttab  -t "Rest API 02" "ssh -t -A craigferguson@jump-box.takealot.com \"ssh tal-rest-api02 'cat /var/log/supervisor/services.order.error.log*'\" | grep '$1'"
}
grep_restapi03() {
  ttab  -t "Rest API 03" "ssh -t -A craigferguson@jump-box.takealot.com \"ssh tal-rest-api03 'cat /var/log/supervisor/services.order.error.log*'\" | grep '$1'"
}
grep_restapi04() {
  ttab  -t "Rest API 04" "ssh -t -A craigferguson@jump-box.takealot.com \"ssh tal-rest-api04 'cat /var/log/supervisor/services.order.error.log*'\" | grep '$1'"
}
grep_orders() {
  ssh-add
  $(grep_restapi01 "$1")
  $(grep_restapi02 "$1")
  $(grep_restapi03 "$1")
  $(grep_restapi04 "$1")
}
grep_wmsapi02() {
  ttab  -t "WMSAPI02" "ssh -t -A craigferguson@jump-box.takealot.com \"ssh wmsapi02 'cat /var/log/supervisor/services.wms.error.log*'\" | grep '$1'"
}
grep_wmsapi03() {
  ttab  -t "WMSAPI03" "ssh -t -A craigferguson@jump-box.takealot.com \"ssh wmsapi03 'cat /var/log/supervisor/services.wms.error.log*'\" | grep '$1'"
}
grep_wmsapi05() {
  ttab  -t "WMSAPI05" "ssh -t -A craigferguson@jump-box.takealot.com \"ssh wmsapi05 'cat /var/log/supervisor/services.wms.error.log*'\" | grep '$1'"
}
grep_wmsapi() {
  ssh-add
  $(grep_wmsapi02 "$1")
  $(grep_wmsapi03 "$1")
  $(grep_wmsapi05 "$1")
}
grep_wmsapi_short() {
  ttab  -t "WMSAPI02" "ssh -t -A craigferguson@jump-box.takealot.com \"ssh wmsapi02 'cat /var/log/supervisor/services.wms.error.log'\" | grep '$1'"
  ttab  -t "WMSAPI03" "ssh -t -A craigferguson@jump-box.takealot.com \"ssh wmsapi03 'cat /var/log/supervisor/services.wms.error.log'\" | grep '$1'"
  ttab  -t "WMSAPI05" "ssh -t -A craigferguson@jump-box.takealot.com \"ssh wmsapi05 'cat /var/log/supervisor/services.wms.error.log'\" | grep '$1'"
}
tail_mrd() {
  ssh-add
  ttab  -t "MRD" "ssh -t -A craigferguson@jump-box.takealot.com \"ssh mrd01 'tail -n 1000 /var/log/supervisor/mrd.log'\" | grep '$1';ssh -t -A craigferguson@jump-box.takealot.com \"ssh mrd02 'tail -n 1000 /var/log/supervisor/mrd.log'\" | grep '$1'"
}
grep_mrd() {
  ssh-add
  ttab  -t "MRD" "ssh -t -A craigferguson@jump-box.takealot.com \"ssh mrd01 'cat /var/log/supervisor/mrd.log*'\" | grep '$1';ssh -t -A craigferguson@jump-box.takealot.com \"ssh mrd02 'cat /var/log/supervisor/mrd.log*'\" | grep '$1'"
}
grep_cpt_sick_logs() {
  ssh-add
  ttab -t "SICK cpt inline 1" -w "ssh -t -A craigferguson@jump-box.takealot.com \"ssh s4f-services01 'cat /var/log/supervisor/tcp_socket_client_cpt_inline_01.0.log | grep $1'\" | grep '$1' ;"
  ttab -t "SICK cpt static 1" -w "ssh -t -A craigferguson@jump-box.takealot.com \"ssh s4f-services01 'cat /var/log/supervisor/tcp_socket_client_cpt_static_01.0.log | grep $1'\" | grep '$1' ;"
  ttab -t "SICK cpt static 2" -w "ssh -t -A craigferguson@jump-box.takealot.com \"ssh s4f-services01 'cat /var/log/supervisor/tcp_socket_client_cpt_static_02.0.log | grep $1'\" | grep '$1' ;"
}
grep_jhb_sick_logs() {
  ssh-add
  ttab -t "SICK jhb inline 1" -w "ssh -t -A craigferguson@jump-box.takealot.com \"ssh s4f-services01 'cat /var/log/supervisor/tcp_socket_client_jhb_inline_01.0.log | grep $1'\" | grep '$1' ;"
  ttab -t "SICK jhb inline 2" -w "ssh -t -A craigferguson@jump-box.takealot.com \"ssh s4f-services01 'cat /var/log/supervisor/tcp_socket_client_jhb_inline_02.0.log | grep $1'\" | grep '$1' ;"
  ttab -t "SICK jhb static 1" -w "ssh -t -A craigferguson@jump-box.takealot.com \"ssh s4f-services01 'cat /var/log/supervisor/tcp_socket_client_jhb_static_01.0.log | grep $1'\" | grep '$1' ;"
  ttab -t "SICK jhb static 2" -w "ssh -t -A craigferguson@jump-box.takealot.com \"ssh s4f-services01 'cat /var/log/supervisor/tcp_socket_client_jhb_static_02.0.log | grep $1'\" | grep '$1' ;"
  }
  showcode() {
    ssh-add
    local temppath="/usr/local/tal/tal/$2"
    ssh -A craigferguson@jump-box.takealot.com ssh $1 cat $temppath
  }
  watch_sickmachine() {
    ssh-add
    ssh -t -A craigferguson@jump-box.takealot.com ./helpers/sickwatch.sh
  }
  restartCPTSICKInline() {
    ssh-add
    ssh -A craigferguson@jump-box.takealot.com ssh s4f-services01 supervisorctl restart tcp_socket_client_cpt_inline
  }
  restartCPTSICKStatic01() {
    ssh-add
    ssh -A craigferguson@jump-box.takealot.com ssh s4f-services01 supervisorctl restart tcp_socket_client_cpt_static_01
  }
  restartCPTSICKStatic02() {
    ssh-add
    ssh -A craigferguson@jump-box.takealot.com ssh s4f-services01 supervisorctl restart tcp_socket_client_cpt_static_02
  }
  restartJHBSICKInline() {
    ssh-add
    ssh -A craigferguson@jump-box.takealot.com ssh s4f-services01 supervisorctl restart tcp_socket_client_jhb_inline
  }
  restartJHBSICKStatic() {
    ssh-add
    ssh -A craigferguson@jump-box.takealot.com ssh s4f-services01 supervisorctl restart tcp_socket_client_jhb_static
  }

  stop_retry_failed_order_injections() {
    #ssh -t -A craigferguson@jump-box.takealot.com "ssh toor@wmsapi02 ps aux | grep retry | awk '{print \$2}' | head -1 | xargs kill"
    ssh -t -A craigferguson@jump-box.takealot.com "ssh toor@wmsapi02 pkill -KILL -f retry_failed"
    #
    #ssh -t -A craigferguson@jump-box.takealot.com "kill \$(ps -ef | grep retry | awk '{ print \$2}' | head -1)"
  }
show_activate() {
  echo 'export ROLE=DC;source /usr/local/tal/tal/venv/bin/activate; export PYTHONPATH=/usr/local/tal/tal;'
}
retry_failed_order_injections() {
    ttab  -t "retry oi" "ssh -t -A craigferguson@jump-box.takealot.com \"ssh toor@wmsapi02 'export ROLE=DC;source /usr/local/tal/tal/venv/bin/activate; export PYTHONPATH=/usr/local/tal/tal; python /usr/local/tal/tal/tal/services/outbound_orders/bin/retry_failed_order_injections.py'\" "
}
run_on_wms() {
    ssh-add
    ssh -tt -A craigferguson@jump-box.takealot.com "ssh -t wmsapi02 bash -l "
}

gpush() {
  local branch=`git rev-parse --abbrev-ref HEAD`
  [[ "$branch" == "master" ]] && echo "should be on feature branch" && return 1
  git push origin HEAD:$branch $@
}
gpr() {
  local branch=`git rev-parse --abbrev-ref HEAD`
#check tracking master
  #set following master
  [[ "$branch" == "master" ]] && echo "should be on feature branch" && return 1
git branch --set-upstream-to=origin/master branch
  git push origin HEAD:$branch || return 1
  hub pull-request -h $branch
}
grelease() {
  local branch=`git rev-parse --abbrev-ref HEAD`
  [[ "$branch" == "master" ]] && echo "should be on feature branch" && return 1
  git pull --rebase || return 1
# squash your commits into sensible chunks
  git rebase -i
  git push origin HEAD:$branch -f || return 1
  git push origin HEAD:master || return 1
  git checkout master || return 1
  git push origin :$branch || return 1
  git branch -d $branch || return 1
}

# function that will compose two other commands
#kafka commands
KRun() {
  docker run --rm -it --net=host landoop/fast-data-dev bash -c -
}
KCreate() {
  cat "kafka-topics --zookeeper 127.0.0.1:2181 --create --topic $1 --partitions 3 --replication-factor 1" | sed 's_$1_'$1'_' | KRun -
}
catdifffile() {
  cat diffs| awk '{print $14}' | awk '{print "("$1 " AND ERROR)"}'
}

# Auto convert .... to ../..
# zstyle ':prezto:module:editor' dot-expansion 'yes'

# Allow the zsh prompt context to be shown.
#zstyle ':prezto:module:editor' ps-context 'yes'

#
# Git
#

# Ignore submodules when they are 'dirty', 'untracked', 'all', or 'none'.
# zstyle ':prezto:module:git:status:ignore' submodules 'all'

#
# GNU Utility
#

# Set the command prefix on non-GNU systems.
# zstyle ':prezto:module:gnu-utility' prefix 'g'

#
# History Substring Search
#

# Set the query found color.
# zstyle ':prezto:module:history-substring-search:color' found ''

# Set the query not found color.
# zstyle ':prezto:module:history-substring-search:color' not-found ''

# Set the search globbing flags.
# zstyle ':prezto:module:history-substring-search' globbing-flags ''

#
# Pacman
#

# Set the Pacman frontend.
# zstyle ':prezto:module:pacman' frontend 'yaourt'

#
# Prompt
#

# Set the prompt theme to load.
# Setting it to 'random' loads a random theme.
# Auto set to 'off' on dumb terminals.

# Set how themes that use promptpwd function display the pwd, can be 'short', 'long', or 'full'
# zstyle ':prezto:module:prompt' pwd-length 'short'

#
# Ruby
#

# Auto switch the Ruby version on directory change.
# zstyle ':prezto:module:ruby:chruby' auto-switch 'yes'

#
# Screen
#

# Auto start a session when Zsh is launched in a local terminal.
# zstyle ':prezto:module:screen:auto-start' local 'yes'

# Auto start a session when Zsh is launched in a SSH connection.
# zstyle ':prezto:module:screen:auto-start' remote 'yes'

#
# SSH
#

# Set the SSH identities to load into the agent.
# zstyle ':prezto:module:ssh:load' identities 'id_rsa' 'id_rsa2' 'id_github'

#
# Syntax Highlighting
#

# Set syntax highlighters.
# By default, only the main highlighter is enabled.
# zstyle ':prezto:module:syntax-highlighting' highlighters \
#   'main' \
#   'brackets' \
#   'pattern' \
#   'line' \
#   'cursor' \
#   'root'
#
# Set syntax highlighting styles.
# zstyle ':prezto:module:syntax-highlighting' styles \
#   'builtin' 'bg=blue' \
#   'command' 'bg=blue' \
#   'function' 'bg=blue'
#
# Set syntax pattern styles.
# zstyle ':prezto:module:syntax-highlighting' pattern \
#   'rm*-rf*' 'fg=white,bold,bg=red'

#
# Terminal
#

# Auto set the tab and window titles.
# zstyle ':prezto:module:terminal' auto-title 'yes'

# Set the window title format.
# zstyle ':prezto:module:terminal:window-title' format '%n@%m: %s'

# Set the tab title format.
# zstyle ':prezto:module:terminal:tab-title' format '%m: %s'

# Set the terminal multiplexer title format.
# zstyle ':prezto:module:terminal:multiplexer-title' format '%s'

#
# Tmux
#

# Auto start a session when Zsh is launched in a local terminal.
 #zstyle ':prezto:module:tmux:auto-start' local 'yes'

# Auto start a session when Zsh is launched in a SSH connection.
# zstyle ':prezto:module:tmux:auto-start' remote 'yes'

# Integrate with iTerm2.
# zstyle ':prezto:module:tmux:iterm' integrate 'yes'

# Set the default session name:
 zstyle ':prezto:module:tmux:session' name 'CraigSession'
#source files
source $HOME/workspace/cdev/helpers/kafka/kafka_util.sh
